<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>üé≤ Game T√†i X·ªâu Demo 3D</title>
<style>
body { margin:0; padding:0; font-family:sans-serif; background:#0b0b0b; color:#fff; text-align:center;}
.container { max-width:900px; margin:0 auto; padding:20px;}
h1 { margin-bottom:10px;}
button { padding:10px 20px; margin:5px; font-size:16px; cursor:pointer; border:none; border-radius:5px;}
input, select { padding:8px; margin:5px; border-radius:4px; border:none; }
.login-section, .game-section { margin-top:20px; }
.dice-table { display:inline-block; perspective:1000px; margin:20px; position:relative; width:120px; height:120px; }
.dice { width:100px; height:100px; background:#fff; color:#000; font-size:40px;
       position:absolute; top:10px; left:10px; display:flex; justify-content:center; align-items:center;
       transform-style: preserve-3d; border-radius:10px; transition: transform 1s cubic-bezier(0.4,0,0.2,1);}
.dice-face { position:absolute; width:100px; height:100px; display:flex; justify-content:center; align-items:center; font-size:40px;}
.cup { width:130px; height:130px; background:#660000; border-radius:50% / 25%; position:absolute; top:-5px; left:-5px;
       transform-origin:center center; transition: transform 1s ease; z-index:10;}
.history { text-align:left; max-height:200px; overflow-y:auto; margin-top:20px; border-top:1px solid #555; padding-top:10px;}
.balance { font-weight:bold; margin-top:10px;}
</style>
</head>
<body>
<div class="container">
  <h1>üé≤ Game T√†i X·ªâu Demo 3D</h1>
  
  <div class="login-section">
    <input type="text" id="username" placeholder="T√™n ƒëƒÉng nh·∫≠p">
    <input type="password" id="password" placeholder="M·∫≠t kh·∫©u">
    <button onclick="register()">ƒêƒÉng k√Ω</button>
    <button onclick="login()">ƒêƒÉng nh·∫≠p</button>
    <div id="loginMsg"></div>
  </div>
  
  <div class="game-section" style="display:none;">
    <div class="balance">S·ªë d∆∞: <span id="balance">0</span> ‚Ç´</div>
    <div>
      C∆∞·ª£c: <input type="number" id="betAmount" value="100" min="1"> ‚Ç´
    </div>
    <div>
      <button onclick="placeBet('T√†i')">T√†i</button>
      <button onclick="placeBet('X·ªâu')">X·ªâu</button>
    </div>
    <div class="dice-table">
      <div class="cup" id="cup"></div>
      <div class="dice" id="dice1">üé≤</div>
      <div class="dice" id="dice2">üé≤</div>
      <div class="dice" id="dice3">üé≤</div>
    </div>
    <div><button onclick="rollDice()">Quay x√∫c x·∫Øc</button></div>
    <div>K·∫øt qu·∫£: <span id="result">-</span></div>
    <div class="history" id="history"></div>
  </div>
</div>

<audio id="soundDice" src="https://www.myinstants.com/media/sounds/dice.mp3"></audio>
<audio id="soundCup" src="https://www.myinstants.com/media/sounds/cup.mp3"></audio>

<script>
// ======== USER SYSTEM =========
let currentUser = null;
const usersKey = "tx_demo_users";

function getUsers() { return JSON.parse(localStorage.getItem(usersKey) || '{}'); }
function saveUsers(users) { localStorage.setItem(usersKey, JSON.stringify(users)); }
function hashPassword(pw) { return btoa(pw); }

function register() {
  const name = document.getElementById('username').value.trim();
  const pw = document.getElementById('password').value;
  if(!name || !pw) { alert("Nh·∫≠p ƒë·ªß th√¥ng tin"); return; }
  let users = getUsers();
  if(users[name]) { alert("User ƒë√£ t·ªìn t·∫°i"); return; }
  users[name] = { pw: hashPassword(pw), balance:1000, history:[] };
  saveUsers(users);
  alert("ƒêƒÉng k√Ω th√†nh c√¥ng! ƒêƒÉng nh·∫≠p ƒë·ªÉ ch∆°i");
}

function login() {
  const name = document.getElementById('username').value.trim();
  const pw = document.getElementById('password').value;
  let users = getUsers();
  if(!users[name] || users[name].pw !== hashPassword(pw)) {
    alert("Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u"); return;
  }
  currentUser = name;
  document.getElementById('loginMsg').innerText = "ƒêƒÉng nh·∫≠p th√†nh c√¥ng: " + name;
  document.querySelector('.login-section').style.display = "none";
  document.querySelector('.game-section').style.display = "block";
  updateBalance(); renderHistory();
}

// ======== GAME LOGIC =========
let currentBet = null;
let autoRollInterval = null;

function updateBalance() {
  const users = getUsers();
  document.getElementById('balance').innerText = users[currentUser].balance;
}

function renderHistory() {
  const users = getUsers();
  const histEl = document.getElementById('history');
  histEl.innerHTML = "";
  users[currentUser].history.slice().reverse().forEach(h => {
    const div = document.createElement('div');
    div.textContent = `C∆∞·ª£c: ${h.bet} ${h.amount} ‚Ç´, K·∫øt qu·∫£: ${h.result}, T·ªïng: ${h.total}, Th·∫Øng: ${h.win} ‚Ç´`;
    histEl.appendChild(div);
  });
}

function placeBet(choice) {
  currentBet = choice;
  alert("B·∫°n ƒë√£ ƒë·∫∑t c∆∞·ª£c: " + choice);
}

// ======== DICE & CUP ANIMATION =========
function rollDice() {
  const betAmount = parseInt(document.getElementById('betAmount').value) || 100;
  if(!currentBet) { alert("Vui l√≤ng ƒë·∫∑t c∆∞·ª£c"); return; }
  const users = getUsers();
  if(users[currentUser].balance<betAmount){ alert("Kh√¥ng ƒë·ªß s·ªë d∆∞"); return; }

  document.getElementById('result').innerText = "-";
  const cup = document.getElementById('cup');
  cup.style.transform="rotateX(0deg)"; // cup √∫p
  document.getElementById('soundCup').play();

  const diceEls = [document.getElementById('dice1'),document.getElementById('dice2'),document.getElementById('dice3')];
  diceEls.forEach(d => { d.innerText="üé≤"; });

  // shake dice
  let rolls=[]; let count=0;
  const shakeInterval = setInterval(()=> {
    rolls = [1+Math.floor(Math.random()*6),1+Math.floor(Math.random()*6),1+Math.floor(Math.random()*6)];
    diceEls[0].innerText=rolls[0];
    diceEls[1].innerText=rolls[1];
    diceEls[2].innerText=rolls[2];
    diceEls.forEach((d,i)=>d.style.transform=`rotateX(${Math.random()*720}deg) rotateY(${Math.random()*720}deg)`);
    count++;
    if(count>=20){ clearInterval(shakeInterval);
      setTimeout(()=>{ cup.style.transform="rotateX(-180deg)"; showResult(rolls, betAmount); },500);
    }
  },100);
  document.getElementById('soundDice').play();
}

function showResult(rolls, betAmount){
  const total = rolls.reduce((a,b)=>a+b,0);
  let resultText = "";
  if(rolls[0]==rolls[1] && rolls[1]==rolls[2]) resultText="Triple - Thua t·∫•t c·∫£";
  else resultText = (total>=11 && total<=17) ? "T√†i" : "X·ªâu";

  document.getElementById('result').innerText=resultText;

  const users=getUsers();
  let win=0;
  if(resultText===currentBet) win=betAmount;
  users[currentUser].balance += win - (win===0?betAmount:0);
  users[currentUser].history.push({bet:currentBet,amount:betAmount,result:resultText,total,win});
  saveUsers(users); updateBalance(); renderHistory();
  currentBet=null;
}

// ======== AUTO ROLL =========
function startAutoRoll() {
  autoRollInterval = setInterval(()=>{
    if(currentUser){
      currentBet=["T√†i","X·ªâu"][Math.floor(Math.random()*2)];
      document.getElementById('betAmount').value = 100+Math.floor(Math.random()*400); // random bet demo
      rollDice();
    }
  },30000);
}
startAutoRoll();
</script>
</body>
</html>
